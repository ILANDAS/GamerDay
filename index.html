<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Super Mini Mario ‚Äî D√≠a del Gamer üéÆ</title>
  <style>
    :root { --bg:#0d0f1a; --ui:#1b1f34; --accent2:#ff5252; }
    html,body { height:100%; margin:0; background:linear-gradient(180deg,#0b1120,#141a2e); color:#e6e8ef; font-family:system-ui,Segoe UI,Roboto,Ubuntu,Inter,sans-serif; display:flex; flex-direction:column; align-items:center; gap:10px; }
    header { width:min(100%,1024px); display:flex; align-items:center; justify-content:space-between; padding:12px 16px; }
    .brand { font-weight:800; font-size:clamp(16px,3vw,22px); }
    .pill { background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:999px; font-size:12px; }
    #wrapper { position:relative; width:min(96vw,1024px); aspect-ratio:16/9; background:var(--bg); border:1px solid rgba(255,255,255,.1); border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    canvas { width:100%; height:100%; image-rendering: pixelated; display:block; background:linear-gradient(#5ec4ff,#b9ecff 35%, #8be37a 36%, #a8f08e); }
    #hud { position:absolute; inset:0; pointer-events:none; display:flex; justify-content:space-between; align-items:flex-start; padding:10px; font-weight:700; text-shadow:0 2px 0 rgba(0,0,0,.35); }
    #hud span { background:rgba(0,0,0,.25); padding:6px 10px; border-radius:10px; }
    #help { position:absolute; left:50%; transform:translateX(-50%); bottom:10px; font-size:12px; opacity:.9; background:rgba(0,0,0,.25); padding:6px 10px; border-radius:10px; }
    .btnbar { position:absolute; right:10px; bottom:10px; display:flex; gap:8px; }
    .btn { background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); color:#fff; font-weight:700; padding:8px 12px; border-radius:10px; cursor:pointer; }
    #touch { position:absolute; left:10px; bottom:10px; display:grid; grid-template-columns:repeat(3,48px); grid-template-rows:repeat(2,48px); gap:6px; }
    #touch button { width:48px; height:48px; border-radius:12px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); color:#fff; font-size:16px; font-weight:900; }
    #messageBox { position:absolute; top:40%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.7); color:#fff; padding:20px; border-radius:12px; font-size:20px; font-weight:700; text-align:center; display:none; }
  </style>
</head>
<body>
  <header>
    <div class="brand">Super Mini Mario ‚Äî hecho con üíõ por ti</div>
    <div class="pill">D√≠a del Gamer: reg√°lale un juego üéÅ</div>
  </header>

  <div id="wrapper">
    <canvas id="game" width="960" height="540"></canvas>
    <div id="hud">
      <span id="coins">‚ù§Ô∏è 0</span>
      <span id="status">Nivel 1</span>
    </div>
    <div id="help">Controles: ‚Üê ‚Üí para moverte ‚Ä¢ Z / ‚Üë para saltar ‚Ä¢ R reiniciar</div>
    <div class="btnbar"><button class="btn" id="reset">Reiniciar (R)</button></div>
    <div id="touch">
      <button data-key="ArrowLeft">‚Üê</button>
      <button data-key="ArrowUp">‚Üë</button>
      <button data-key="ArrowRight">‚Üí</button>
      <button data-key="KeyZ" style="grid-column:1 / span 3">SALTAR</button>
    </div>
    <div id="messageBox"></div>
  </div>

  <script>
  const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
  const TILE=32,GRAVITY=0.5,FRICTION=0.85,MAX_SPEED_X=4.2,JUMP_VELOCITY=-10.5;
  const uiCoins=document.getElementById('coins'),uiStatus=document.getElementById('status'),messageBox=document.getElementById('messageBox');

  const levels=[ 
    [
      '..............................................................................',
      '..............................................................................',
      '............................o..............o..................................',
      '......................###.............###...........................o.........',
      '..............o.............o......................o..........................',
      '..........####...........#####.............####....................####.......',
      '......................................................o.......................',
      '....P..................o.............E.............#####..................F..',
      '#############################..###############################..##############',
    ],
    [
      '..............................................................................',
      '....................................o..............o.........................',
      '..............o.............#####.......................E....................',
      '.............###.......................o...........#####.....................',
      '....P....................o.................................................F.',
      '#########....###########################....#########################..######',
    ],
    [
      '..............................................................................',
      '.....................................o.............o.........................',
      '..............o..............###...............E..............................',
      '.............###...................o.....................#####...............',
      '.....o..................####.............E...........o...................F...',
      '....P.............o.........................................................',
      '#########....#########....###########################....##############..####',
    ]
  ];

  const colors={solid:'#2b235a',enemy:'#d94f4f',player:'#ff6f3c',flag:'#3ad06d',heart:'#ff4d6d'};

  let levelIndex=0,world,player,coins,enemies,flag,camera,coinCount=0,keys={},transitioning=false;

  function loadLevel(i){
    const map=levels[i]; world={w:map[0].length*TILE,h:map.length*TILE,solids:[]};
    coins=[];enemies=[];flag=null;player=null;
    for(let y=0;y<map.length;y++)for(let x=0;x<map[y].length;x++){
      const ch=map[y][x],rect={x:x*TILE,y:y*TILE,w:TILE,h:TILE};
      if(ch==='#')world.solids.push(rect);
      if(ch==='o')coins.push({x:x*TILE+8,y:y*TILE+8,taken:false,baseY:y*TILE+8,phase:Math.random()*Math.PI*2});
      if(ch==='E')enemies.push({x:x*TILE+4,y:y*TILE,w:TILE-8,h:TILE-2,vx:Math.random()<.5?-1.2:1.2,vy:0,alive:true});
      if(ch==='F')flag={x:x*TILE+8,y:y*TILE-64,w:8,h:64};
      if(ch==='P')player={x:x*TILE,y:y*TILE,w:24,h:30,vx:0,vy:0,onGround:false,facing:1};
    }
    if(!player)player={x:16,y:16,w:24,h:30,vx:0,vy:0,onGround:false,facing:1};
    camera={x:Math.max(0,player.x-canvas.width/2),y:0};
    uiStatus.textContent=`Nivel ${levelIndex+1}`;
  }

  function rectsOverlap(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}

  function resolveCollisions(e){
    e.x+=e.vx;
    for(const s of world.solids){if(rectsOverlap(e,s)){if(e.vx>0)e.x=s.x-e.w;else if(e.vx<0)e.x=s.x+s.w;e.vx=0;}}
    e.y+=e.vy; e.onGround=false;
    for(const s of world.solids){if(rectsOverlap(e,s)){if(e.vy>0){e.y=s.y-e.h;e.vy=0;e.onGround=true;}else if(e.vy<0){e.y=s.y+s.h;e.vy=0;}}}
  }

  function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

  window.addEventListener('keydown',e=>{keys[e.code]=true;if(['ArrowUp','KeyZ'].includes(e.code))e.preventDefault();if(e.code==='KeyR')loadLevel(levelIndex);});
  window.addEventListener('keyup',e=>keys[e.code]=false);
  document.getElementById('reset').addEventListener('click',()=>loadLevel(levelIndex));

  function showMessage(text,cb){messageBox.textContent=text;messageBox.style.display='block';setTimeout(()=>{messageBox.style.display='none';if(cb)cb();},2500);}

  function update(){
    const accel=0.6;
    if(keys['ArrowLeft']){player.vx-=accel;player.facing=-1;}
    if(keys['ArrowRight']){player.vx+=accel;player.facing=1;}
    player.vx*=FRICTION; player.vx=clamp(player.vx,-MAX_SPEED_X,MAX_SPEED_X);
    if((keys['ArrowUp']||keys['KeyZ'])&&player.onGround)player.vy=JUMP_VELOCITY;
    player.vy+=GRAVITY; resolveCollisions(player);
    if(player.y>world.h+200){loadLevel(levelIndex);return;}

    // üíñ Animaci√≥n flotante de corazones
    const time=Date.now()/400;
    for(const c of coins){
      if(!c.taken){
        c.y=c.baseY+Math.sin(time+c.phase)*6; // flotaci√≥n suave
        if(rectsOverlap(player,{x:c.x-6,y:c.y-6,w:12,h:12})){
          c.taken=true;coinCount++;uiCoins.textContent=`‚ù§Ô∏è ${coinCount}`;
        }
      }
    }

    for(const e of enemies){
      if(!e.alive)continue;
      e.vy+=GRAVITY; e.x+=e.vx; e.y+=e.vy;
      for(const s of world.solids){if(rectsOverlap(e,s)){if(e.vx>0)e.x=s.x-e.w;else if(e.vx<0)e.x=s.x+s.w;e.vx*=-1;}}
      for(const s of world.solids){if(rectsOverlap(e,s)){if(e.vy>0){e.y=s.y-e.h;e.vy=0;}else if(e.vy<0){e.y=s.y+s.h;e.vy=0;}}}
      if(rectsOverlap(e,player)){if(player.vy>0&&player.y+player.h-e.y<16){e.alive=false;player.vy=JUMP_VELOCITY*0.6;}else{loadLevel(levelIndex);return;}}
    }

    if(!transitioning && flag && rectsOverlap(player,{x:flag.x-8,y:flag.y,w:flag.w+16,h:flag.h+8})){
      transitioning=true;
      if(levelIndex<levels.length-1){
        showMessage("Ya est√°s cerca mi amor, sigue as√≠ ‚ù§Ô∏è",()=>{levelIndex++;loadLevel(levelIndex);transitioning=false;});
      }else{
        showMessage("üéÆ Feliz d√≠a del gamer mi amor üíñ",()=>{transitioning=false;});
      }
    }

    camera.x=clamp(player.x-canvas.width/2,0,Math.max(0,world.w-canvas.width));
  }

  function drawHeart(x, y, size) {
    const gradient = ctx.createRadialGradient(x, y, size * 0.1, x, y, size);
    gradient.addColorStop(0, "#ff99aa");
    gradient.addColorStop(1, "#ff0033");
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.moveTo(x, y + size / 4);
    ctx.bezierCurveTo(x, y, x - size / 2, y, x - size / 2, y + size / 4);
    ctx.bezierCurveTo(x - size / 2, y + size / 2, x, y + size * 0.75, x, y + size);
    ctx.bezierCurveTo(x, y + size * 0.75, x + size / 2, y + size / 2, x + size / 2, y + size / 4);
    ctx.bezierCurveTo(x + size / 2, y, x, y, x, y + size / 4);
    ctx.fill();
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save(); ctx.translate(-camera.x,-camera.y);
    for(const s of world.solids){ctx.fillStyle=colors.solid;ctx.fillRect(s.x,s.y,s.w,s.h);}
    for(const c of coins){if(!c.taken)drawHeart(c.x,c.y,14);}
    if(flag){ctx.fillStyle='#8e8e8e';ctx.fillRect(flag.x,flag.y,4,flag.h);ctx.fillStyle=colors.flag;ctx.fillRect(flag.x+4,flag.y+8,20,14);}
    for(const e of enemies){if(e.alive){ctx.fillStyle=colors.enemy;ctx.fillRect(e.x,e.y,e.w,e.h);}}
    ctx.save();ctx.translate(player.x+player.w/2,player.y+player.h/2);ctx.scale(player.facing,1);ctx.fillStyle=colors.player;ctx.fillRect(-player.w/2,-player.h/2,player.w,player.h);ctx.restore();
    ctx.restore();
  }

  function loop(){update();draw();requestAnimationFrame(loop);}
  function fitCanvas(){const rect=canvas.getBoundingClientRect();const ratio=window.devicePixelRatio||1;canvas.width=Math.round(rect.width*ratio);canvas.height=Math.round(rect.height*ratio);}
  window.addEventListener('resize',fitCanvas);
  fitCanvas(); loadLevel(levelIndex); loop();
  </script>
</body>
</html>

